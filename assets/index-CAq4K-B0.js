(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=a(t);fetch(t.href,i)}})();const V=`struct Uniforms {
  mvpMatrix : mat4x4<f32>,
};

@binding(0) @group(0) var<uniform> uniforms : Uniforms;

struct VertexOutput {
  @builtin(position) Position : vec4<f32>,
  @location(0) color: vec3<f32>,
};

@vertex
fn main(@location(0) position: vec3<f32>,
        @location(1) color: vec3<f32>) -> VertexOutput {
  var output: VertexOutput;
  output.Position = uniforms.mvpMatrix * vec4<f32>(position, 1.0);
  output.color = color;
  return output;
}`,q=`@fragment
fn main(@location(0) color: vec3<f32>) -> @location(0) vec4<f32> {
  return vec4<f32>(color, 1.0);
}`;var T=typeof Float32Array<"u"?Float32Array:Array;function S(){var e=new T(16);return T!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function D(e,r,a){var n=r[0],t=r[1],i=r[2],s=r[3],l=r[4],u=r[5],p=r[6],m=r[7],v=r[8],g=r[9],y=r[10],x=r[11],P=r[12],h=r[13],w=r[14],A=r[15],o=a[0],c=a[1],f=a[2],d=a[3];return e[0]=o*n+c*l+f*v+d*P,e[1]=o*t+c*u+f*g+d*h,e[2]=o*i+c*p+f*y+d*w,e[3]=o*s+c*m+f*x+d*A,o=a[4],c=a[5],f=a[6],d=a[7],e[4]=o*n+c*l+f*v+d*P,e[5]=o*t+c*u+f*g+d*h,e[6]=o*i+c*p+f*y+d*w,e[7]=o*s+c*m+f*x+d*A,o=a[8],c=a[9],f=a[10],d=a[11],e[8]=o*n+c*l+f*v+d*P,e[9]=o*t+c*u+f*g+d*h,e[10]=o*i+c*p+f*y+d*w,e[11]=o*s+c*m+f*x+d*A,o=a[12],c=a[13],f=a[14],d=a[15],e[12]=o*n+c*l+f*v+d*P,e[13]=o*t+c*u+f*g+d*h,e[14]=o*i+c*p+f*y+d*w,e[15]=o*s+c*m+f*x+d*A,e}function I(e,r,a){var n=a[0],t=a[1],i=a[2],s,l,u,p,m,v,g,y,x,P,h,w;return r===e?(e[12]=r[0]*n+r[4]*t+r[8]*i+r[12],e[13]=r[1]*n+r[5]*t+r[9]*i+r[13],e[14]=r[2]*n+r[6]*t+r[10]*i+r[14],e[15]=r[3]*n+r[7]*t+r[11]*i+r[15]):(s=r[0],l=r[1],u=r[2],p=r[3],m=r[4],v=r[5],g=r[6],y=r[7],x=r[8],P=r[9],h=r[10],w=r[11],e[0]=s,e[1]=l,e[2]=u,e[3]=p,e[4]=m,e[5]=v,e[6]=g,e[7]=y,e[8]=x,e[9]=P,e[10]=h,e[11]=w,e[12]=s*n+m*t+x*i+r[12],e[13]=l*n+v*t+P*i+r[13],e[14]=u*n+g*t+h*i+r[14],e[15]=p*n+y*t+w*i+r[15]),e}function z(e,r,a){var n=Math.sin(a),t=Math.cos(a),i=r[4],s=r[5],l=r[6],u=r[7],p=r[8],m=r[9],v=r[10],g=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=i*t+p*n,e[5]=s*t+m*n,e[6]=l*t+v*n,e[7]=u*t+g*n,e[8]=p*t-i*n,e[9]=m*t-s*n,e[10]=v*t-l*n,e[11]=g*t-u*n,e}function N(e,r,a){var n=Math.sin(a),t=Math.cos(a),i=r[0],s=r[1],l=r[2],u=r[3],p=r[8],m=r[9],v=r[10],g=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*t-p*n,e[1]=s*t-m*n,e[2]=l*t-v*n,e[3]=u*t-g*n,e[8]=i*n+p*t,e[9]=s*n+m*t,e[10]=l*n+v*t,e[11]=u*n+g*t,e}function Y(e,r,a,n,t){var i=1/Math.tan(r/2);if(e[0]=i/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==1/0){var s=1/(n-t);e[10]=(t+n)*s,e[14]=2*t*n*s}else e[10]=-1,e[14]=-2*n;return e}var _=Y;const O=document.getElementById("startButton"),W=document.getElementById("audioOverlay"),R=document.getElementById("errorMessage"),B=document.getElementById("gpuCanvas");let E,M;async function X(){E||(E=new(window.AudioContext||window.webkitAudioContext)),E.state==="suspended"&&await E.resume();try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),r=E.createMediaStreamSource(e);return M=E.createAnalyser(),M.fftSize=2048,M.smoothingTimeConstant=.5,r.connect(M),!0}catch(e){return R.textContent="Error: Microphone access was denied or is not available. Please check your browser settings and refresh the page.",console.error("Error accessing microphone:",e),!1}}async function H(){if(!await X()){O.disabled=!1;return}W.style.display="none",B.style.display="block",await $()}O.addEventListener("click",()=>{O.disabled=!0,R.textContent="Requesting microphone access...",H()});async function $(){if(!navigator.gpu){document.body.innerHTML="<h1>WebGPU not supported!</h1>";return}const r=await(await navigator.gpu.requestAdapter()).requestDevice(),a=B.getContext("webgpu"),n=navigator.gpu.getPreferredCanvasFormat();a.configure({device:r,format:n});let t,i;const s=()=>{B.width=window.innerWidth,B.height=window.innerHeight,t&&t.destroy(),t=r.createTexture({size:[B.width,B.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),i=t.createView()};s(),window.addEventListener("resize",s);const l=new Float32Array(M.fftSize),u=new Float32Array([-.5,-.5,.5,1,0,0,.5,-.5,.5,0,1,0,.5,.5,.5,0,0,1,-.5,.5,.5,1,1,0,-.5,-.5,-.5,0,1,1,.5,-.5,-.5,1,0,1,.5,.5,-.5,1,1,1,-.5,.5,-.5,0,0,0]),p=new Uint16Array([0,1,2,0,2,3,5,4,7,5,7,6,4,0,3,4,3,7,1,5,6,1,6,2,3,2,6,3,6,7,4,5,1,4,1,0]),m=r.createBuffer({size:u.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});r.queue.writeBuffer(m,0,u);const v=r.createBuffer({size:p.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});r.queue.writeBuffer(v,0,p);const g=r.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),y=r.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),x=r.createBindGroup({layout:y,entries:[{binding:0,resource:{buffer:g}}]}),P=r.createRenderPipeline({layout:r.createPipelineLayout({bindGroupLayouts:[y]}),vertex:{module:r.createShaderModule({code:V}),entryPoint:"main",buffers:[{arrayStride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"}]}]},fragment:{module:r.createShaderModule({code:q}),entryPoint:"main",targets:[{format:n}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}});let h=0;function w(){M.getFloatTimeDomainData(l);let A=0;for(const G of l)A+=G*G;const o=Math.sqrt(A/l.length),c=.01+o*5;h+=c,console.log(`Amplitude: ${o.toFixed(4)}, Rotation Speed: ${c.toFixed(4)}`);const f=B.width/B.height,d=S();_(d,45*Math.PI/180,f,.1,10);const U=S();I(U,U,[0,0,-4]),z(U,U,h*.5),N(U,U,h);const C=S();D(C,d,U),r.queue.writeBuffer(g,0,C);const L=r.createCommandEncoder(),F=a.getCurrentTexture().createView(),b=L.beginRenderPass({colorAttachments:[{view:F,loadOp:"clear",storeOp:"store",clearValue:{r:.1,g:.1,b:.1,a:1}}],depthStencilAttachment:{view:i,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});b.setPipeline(P),b.setBindGroup(0,x),b.setVertexBuffer(0,m),b.setIndexBuffer(v,"uint16"),b.drawIndexed(p.length),b.end(),r.queue.submit([L.finish()]),requestAnimationFrame(w)}w()}
